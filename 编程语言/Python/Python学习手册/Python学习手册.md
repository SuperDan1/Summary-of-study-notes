
参考：《Python学习手册》

[TOC]

# Q&A

1. JIT技术与PyPy

# 运行Python程序

## Python执行

### 字节码编译

* 程序执行时，Python内部先将源代码编译成字节码的形式
  * Python通过把每一条源语句翻译成一组字节码指令
  * 字节码可以提高执行速度
* 如果Python进程在机器上拥有写入权限，将把程序的字节码保存为一个以`.pyc`为扩展名的文件
  * 下一次运行程序时，如果在上次保存字节码之后没有修改过源代码的话，Python将会加载`.pyc`文件并跳过编译步骤
  * 它会自动检查源文件和字节码文件的时间戳，如果又保存了源代码，下次程序运行时，字节码将自动重新创建
* 如果Python无法在机器上写入字节码，字节码将会在内存中生成并在程序结束时简单地丢弃

### Python虚拟机（PVM）

* 程序编译成字节码（或者字节码从已经存在的`.pyc`文件中载入），之后的字节码发送到Python虚拟机（Python Virtual Machine，PVM）上执行
* PVM时Python的运行引擎，迭代运行字节码指令的循环

### Python性能

* 性能：比C、C++运行慢

  * Python中没有C++中的`build`和`make`步骤
  * Python字节码不是机器的二进制代码
  * PVM循环仍然需要解释字节码，并且字节码指令与CPU指令相比需要更多的工作

  ![image-20191222155024898](pic/image-20191222155024898.png)

## 执行模块的变体

### Python解释器

> 解释器是一种让其他程序运行起来的程序，Python解释器将读取程序，并按照其中的命令执行得出结果——实际上，解释器是代码与机器的计算机硬件之间的软件逻辑层。

* CPython：官方版本的解释器，是用C语言开发的，在命令行下运行`python`就是启动`CPython`解释器
* IPython：基于`CPython`之上的一个交互式解释器
* PyPy：目标是执行速度——采用`JIT`技术，对Python代码进行动态编译，显著提高Python代码的执行速度
* Jython：运行在Java平台上的Python解释器，可以直接把Python代码编译成Java字节码执行
* IronPython：运行在微软`.Net`平台上的Python解释器，直接把Python代码编译成`.Net`的字节码

### 执行优化工具（TODO）

* Psyco实时编译器：不是Python的实现方式，而是一个扩展字节码执行模块的组件，可以让程序运行地更快
* Shedskin C++转换器

### 冻结二进制文件

> 将Python程序转为可执行程序（Frozen Binary，冻结二进制文件）

* 冻结二进制文件将程序的字节码、PVM（解释器）以及任何程序所需要的Python支持文件捆绑在一起形成一个单独的文件（例如`Windows`中的`.exe`文件）
* 生产冻结二进制文件方法
  * `Windows`平台下的`py2exe`
  * `Linux`平台下的`PyInstaller`

## 模块导入和重载

> 每一个以扩展名py结尾的Python源代码文件都是一个模块。其他的文件可以通过导入一个模块读取这个模块的内容——导入的本质就是载入另一个文件，并能够读取那个文件的内容

* 导入模块时会运行一次，但是也只有一次，因为导入时一个开销很大的操作，以至于每个文件、每个程序运行不能够重复多余一次

* 如果想在同一次会话中再次运行文件，需要调用`imp`标准库模块中可用的`reload`函数

  ```python
  from imp import reload
  reload(test)
  ```


### 模块的显要特性：属性

# 类型和运算

## Python对象类型

> 在Python中，数据以对象的形式出现——无论是Python提供的内置对象，还是使用Python或是像C扩展库这样的扩展语言工具创建的对象

* Python程序可以分解成模块、语句、表达式以及对象
  1. 程序由模块构成
  2. 模块包含语句
  3. 语句包含表达式
  4. 表达式建立并处理对象

### 为什么使用内置类型

## 数字

### Python的数字类型

* 数字常量
  * 整数
  * 浮点数
  * 二进制（`0b`）、八进制（`0o`）、十六进制（`0x`）表示整数
  * 复数：`1+2j`或者`complex(1, 2)`是等价的
* 内置数学工具和扩展
  * 表达式操作费：`+、-、*、/、>>、**、&`
  * 内置数学函数：`pow、abs、round、int、hex、bin`
  * 公用模块：`random`、`math`

## 动态类型简介

### 缺少类型声明语句

> Python中，类型是在运行过程中自动决定的，而不是通过代码声明——这对变量、对象和她们之间的关系都适用

#### 变量、对象和引用

* 变量在赋值的时候才创建，他可以引用任何类型的对象，并且必须在引用之前赋值——不需要通过脚本声明所要适用的名字，但是必须初始化名字然后才能更新它们

* 例子：`a=3`

  * 创建一个对象来代表3
  * 创建一个变量a，如果它还没有创建的话
  * 将变量与新的对象3相连接（**在内部，变量事实上是到对象内存空间的一个指针**）

  ![1577090325071](pic/1577090325071.png)

#### 类型属于对象，而不是变量

#### 对象的垃圾收集

### 共享引用

# 语句和语法

# 函数

## 函数基础

> 一个函数就是将一些语句集合在一起的部件，能够不止一次地在程序中运行。函数是Python为了代码最大程度的重用和最小化代码冗余而提供的最基本的程序结构。

### def语句



# 模块

# 类和oop

# 异常和工具

# 高级话题







